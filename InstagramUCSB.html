<html>
<!--
This web map uses a PHP service to display UCSB geotagged photos retrieved daily from Instagram. 
-->
<head>
	<title>IV Photos</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
</head>
<body style="margin:0;">
	<div id="description" style="width:300px;height:45px;border-radius:5px;margin:10px;padding:10px;overflow-y:auto;overlow-x:hidden;position:absolute;z-index:2;top:0px;left:30px;background-color:#000000;color:ffffff"><font face="Helvetica" size="2">This map shows photos from <font face="Helvetica" size="3"color="ADD8E6"><strong>Instagram</strong></font>. <br>Highlights from Isla Vista are updated <em>daily.</em> Click anywhere on the map to see the coordinates!</div>
	<div id="map" style="width:100%;height:100%"></div>
	<div id="map" #map { height: 180px; }></div>
	<!-- This is where all the cool leaflet framework code is called.  You don't need to change anything here... just useful to know where the important code is -->
	 <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	 <script src="http://spatialdeviant.com/leaflet.ajax.min.js"></script>
	 <script>
  	
  	  // This is where the tile layers are generated
	  var map = new L.Map("map", {
	      center: new L.LatLng(34.415403, -119.845279),
	      zoom:15
	  });

	  // This adds a standalone dialogue with coordinates
	  var dialogue = L.popup()
	  	.setLatLng([34.415403, -119.845279])
    	.setContent("Ellison Hall")
    	.openOn(map);

    // This allows a user to interact with the map and click on a spot for lat/long
    var popup = L.popup();
    function onMapClick(e) {
    	popup
    	.setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);
    } 
    map.on('click', onMapClick);

	  
	  //add an OpenStreetMap tile layer
	  var OSM = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);

	  //add imagery basemap
	  var terrain = L.tileLayer('http://{s}.tile.stamen.com/terrain/{z}/{x}/{y}.jpg').addTo(map);

	  // Instagram GeoJSON AJAX layer
	  var geojsonLayer = new L.GeoJSON.AJAX("http://spatialdeviant.com/instagram.php?username=ucsantabarbara",{onEachFeature:caption,
	  	pointToLayer: function(feature, latlng) {
	  		return L.marker(latlng, {icon:myIcon}).addTo(map);
	  	}
	  });

	  // Custom icon
	 var myIcon = L.icon({
    iconUrl: 'http://static.wixstatic.com/media/c5b5bc_9623bf4a55f147188b890c7688c1b24d.gif',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [24, 24], // point of the icon which will correspond to marker's location
    popupAnchor:  [-25, -30] // point from the popup opens relative to iconAnchor
});

	  // on each feature function
	 function caption(feature, layer) {
	 	if (feature.properties) {
	  	layer.bindPopup('<img src="' + feature.properties.thumbnail + '"</img>' + '</a>' + '<a><div align="center">Username: ' + ' ' + feature.properties.username + '</div>' + '<div align="center">Caption: ' + ' ' + feature.properties.caption + '</div>');
	  }
	};

	  var baseMaps = {
	  	"Street Layer" : OSM,
	  	"Terrain Layer" : terrain

	  };

	  var overlayMaps = {
	  	"Instagram Photos" : geojsonLayer,
	  	"Ellison Hall" : dialogue
	  };

	  //Control layer feature on map
	  L.control.layers(baseMaps, overlayMaps).addTo(map);

        </script>
</body>
</html>
